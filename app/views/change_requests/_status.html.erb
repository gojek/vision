<% if flash[:change_status_notice] %>
    <div class="alert alert-danger">
    <%= flash[:change_status_notice] %>
    </div>
<% end %>

<div class="row">
  <div class="col-lg-2">
    <button class="btn btn-success btn-lg"> Submitted <i class="fa fa-check" aria-hidden="true"></i> </button>
  </div>
  <div class="col-lg-1">
    <i class="fa fa-arrow-right fa-2x" aria-hidden="true"></i>
  </div>
  <% if @change_request.submitted? %>
  <div class="col-lg-2">
    <div class="dropdown">
      <button class="btn btn-primary btn-lg dropdown-toggle" type="button" data-toggle="dropdown">Second Phase
      <span class="caret"></span></button>
      <ul class="dropdown-menu">
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#ScheduleModalLabel">
            Schedule Change Request
          </button>
        </li>
        <li class="divider"></li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#closeModalLabel">
            Close Change Request
          </button>
        </li>
        <li class="divider"></li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#RejectModalLabel">
            Reject Change Request
          </button>
        </li>
      </ul>
    </div>
  </div>
  <% else %>
    <%= render 'status_button', status: @cr_statuses[1].status unless @cr_statuses[1].nil?%>
  <% end %>
  <% if @change_request.scheduled? %>
  <div class="col-lg-2">
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle btn-lg" type="button" data-toggle="dropdown">Third Phase
      <span class="caret"></span></button>
      <ul class="dropdown-menu">
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#closeModalLabel">
            Close Change Request
          </button>
        </li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#DeployModalLabel">
            Deploy Change Request
          </button>
        </li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#RollbackModalLabel">
            Rollback Change Request
          </button>
        </li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#cancelModalLabel">
            Cancel Change Request
          </button>
        </li>
      </ul>
    </div>
  </div>
  <% else %>
  <%= render 'status_button', status: @cr_statuses[2].status unless @cr_statuses[2].nil?%>
  <% end %>
  <% if @change_request.deployed? %>
  <div class="col-lg-2">
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle btn-lg" type="button" data-toggle="dropdown">Final Phase
      <span class="caret"></span></button>
      <ul class="dropdown-menu">
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#RollbackModalLabel">
            Rollback Change Request
          </button>
        </li>
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#closeModalLabel">
            Close Change Request
          </button>
        </li>
      </ul>
    </div>
  </div>
  <% elsif @change_request.rollbacked? %>
  <div class="col-lg-2">
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle btn-lg" type="button" data-toggle="dropdown">Final Phase
      <span class="caret"></span></button>
      <ul class="dropdown-menu">
        <li>
          <button class="btn btn-primary" data-toggle="modal" data-target="#closeModalLabel">
            Close Change Request
          </button>
        </li>
      </ul>
    </div>
  </div>
  <% else %>
  <%= render 'status_button', status: @cr_statuses[3].status unless @cr_statuses[3].nil? %>
  <% end %>
</div>
<div class="modal fade" id="ScheduleModalLabel" tabindex="-1" role="dialog" aria-labelledby="ScheduleModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: schedule_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Schedule Change Request </h4>
          </div>
          <div class="modal-body">
              <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <%= f.submit "Update Change Request Status to Schedule", class: 'btn btn-default'%>
           </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="DeployModalLabel" tabindex="-1" role="dialog" aria-labelledby="DeployModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: deploy_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Deploy Change Request </h4>
          </div>
          <div class="modal-body">
               <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Update Change Request Status to Deploy", class: 'btn btn-default'%>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="SubmitModalLabel" tabindex="-1" role="dialog" aria-labelledby="SubmitModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: submit_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Submit Change Request </h4>
          </div>
          <div class="modal-body">
               <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Update Change Request Status to Submit", class: 'btn btn-default'%>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="RejectModalLabel" tabindex="-1" role="dialog" aria-labelledby="RejectModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: final_reject_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Reject Change Request </h4>
          </div>
          <div class="modal-body">
              <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Update Change Request Status to Reject", class: 'btn btn-default'%>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="RollbackModalLabel" tabindex="-1" role="dialog" aria-labelledby="RollbackModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: rollback_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Rollback Change Request </h4>
          </div>
          <div class="modal-body">
              <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <%= f.submit 'Update Change Request Status to Rollback', class: 'btn btn-default' %>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<div class="modal fade" id="closeModalLabel" tabindex="-1" role="dialog" aria-labelledby="RollbackModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: close_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Close Change Request </h4>
          </div>
          <div class="modal-body">
              <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <%= f.submit 'Update Change Request Status to Close', class: 'btn btn-default'  %>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<div class="modal fade" id="cancelModalLabel" tabindex="-1" role="dialog" aria-labelledby="RollbackModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
      <div class="modal-content">
          <%= form_for(@change_request_status, url: cancel_path) do |f| %>
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h4 class="modal-title" id="myModalLabel">Cancel Change Request </h4>
          </div>
          <div class="modal-body">
              <%= f.label :reason %>
              <%= f.text_area :reason, class: 'form-control' %>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <%= f.submit "Update Change Request Status to Cancel", class: 'btn btn-default' %>
          </div>
          <% end %>
      </div>
      <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
