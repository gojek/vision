<p id="notice"><%= notice %></p>
<div class = "col-md-6">
<h1 class="page-header">Incident Reports</h1>
<div class="panel panel-primary">
  <div class="panel-heading">Change requests </div>
    <div class="panel-body">
       <div class="panel panel-default">
        <div class="panel-heading">Change Summary </div>
        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                </thead>
                <tbody>
                    <thead>
                    <tr>
                        <th> <strong>Requestor's name:</strong> <%= @change_request.requestor_name %></th>
                        
                        <th><strong>Request date: </strong> <%= @change_request.created_at.to_s(:db) %></th>

                    </tr>
                    <th colspan="2"><center><h2><%= @change_request.change_summary %></center></h2></th>
                     </thead>
                </tbody>
            </table>
        </div>
         
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Priority</th>
                    <th>Category</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><%= @change_request.priority %></td>
                    <td><%= @change_request.category %></td>
                    <td><%= @change_request.cr_type %></td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5>Change Requirement</h5>
    <div class="well well-sm">
      <%=raw @change_request.change_requirement%>
    </div>
     <h5>Bussines Justification</h5>
    <div class="well well-sm">
       <%=raw @change_request.business_justification %>
    </div>
    <h5>Requestor</h5>
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Position</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><%= @change_request.requestor_name %></td>
                    <td><%= @change_request.requestor_position %></td>
                </tr>
            </tbody>
        </table>
    </div>
    <h5>Notes</h5>
    <div class="well well-sm">
       <%=raw @change_request.note %>
    </div>
     <h5>Analysis</h5>
    <div class="well well-sm">
      <%=raw @change_request.analysis %>
    </div>
     <h5>Solution</h5>
    <div class="well well-sm">
       <%=raw @change_request.solution %>
    </div>
     <h5>Impact</h5>
    <div class="well well-sm">
       <%=raw @change_request.impact %>
    </div>

  <strong>Scope:</strong>
  <%= @change_request.scope %>
 <h5>CAB</h5>

<% if @change_request.cabs != nil %>
<div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>position</th>
                    <th>Approve</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>

  <% @change_request.cabs.each do |cab| %>
 
  
                <tr>
                    <td><%= cab.name %></td>
                    <td><%= cab.position %></td>
                    <td><%= cab.approve %></td>
                    <td><%= cab.reason %></td>
                </tr>
           
  <% end %>
   </tbody>
        </table>
    </div>
  <% end %>
   <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Design:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td><%=raw @change_request.design %></td>
    </tbody>
    </table>
  </div>
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Backup:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td><%=raw @change_request.backup %></td>
    </tbody>
    </table>
  </div>

<p>
  <strong>Testing environment available:</strong>
  <%= @change_request.testing_environment_available %>
</p>

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Testing Procedure:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td><%=raw @change_request.testing_procedure %></td>
    </tbody>
    </table>
  </div>
  <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>position</th>
                </tr>
            </thead>
            <tbody>
                <% @change_request.testers.each do |tes| %>
 
   
                <tr>
                    <td><%= tes.name %></td>
                    <td><%= tes.position %></td>
                </tr>
           
  <% end %>
   </tbody>
        </table>
    </div>

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Testing Notes:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td><%=raw @change_request.testing_notes %></td>
    </tbody>
    </table>
  </div>
  <h5>Approval: </h5>
  <p>
    After viewing the tesiting procedures and confirmed the testing result are positive, this CR has been confirmed appropiate to  be deployed in production by :
  </p>
   <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>position</th>
                </tr>
            </thead>
            <tbody>
              <% @change_request.approvers.each do |app| %>
                <tr>
                    <td><%= app.user.name %></td>
                    <td><%= app.position %></td>
                </tr>
              <%end %>
            </tbody>
        </table>
    </div>
<h3>Implementation</h3>
  <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th colspan="3">Schedule</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                  <td><strong>Schedule Change</strong></td>
                  <td colspan="2"><%= @change_request.schedule_change_date %></td>
                </tr>
                <tr>
                  <td><strong>Planned Complation</strong></td>
                  <td colspan="2"><%= @change_request.planned_completion %></td>
                </tr>
                <tr>
                  <td><strong>Grace Period Starts</strong></td>
                  <td colspan="2"> <%= @change_request.grace_period_starts %></td>
                </tr>
                <tr>
                  <td><strong>Grace Preiod Ends</strong></td>
                   <td colspan="2"><%= @change_request.grace_period_end %></td>
                </tr>
            </tbody>
        </table>
    </div>

<h5>Implementer</h5>
<div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>position</th>
                </tr>
            </thead>
            <tbody>
<% @change_request.implementers.each do |imp| %>

                <tr>
                    <td><%= imp.name %></td>
                    <td><%= imp.position %></td>
                </tr>
<% end %>
   </tbody>
        </table>
    </div>


  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Implementer Notes:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td><%=raw @change_request.implementation_notes %></td>
    </tbody>
    </table>
  </div>

<div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
      <th> <strong>Grace Notes:</strong></th>
    </tr>
    </thead>
    <tbody>
    <td> <%=raw @change_request.grace_period_notes %></td>
    </tbody>
    </table>
  </div>
</div>

</div>
<%= link_to 'Edit', edit_change_request_path(@change_request) %> |
<%= link_to 'Back', change_requests_path %>
<h2>Comments</h2>
<ul>
<% @change_request.comments.each do |c| %>
<li><%= c.body %> <%= c.user.name %>
<%= link_to 'Destroy Comment', [c.change_request, c],
               method: :delete,
               data: { confirm: 'Are you sure?' } %></li>
<% end %>
</ul>

<h2>Add comment:</h2>
<%= form_for ([@change_request, @change_request.comments.build]) do |f| %>
<%= f.label :comment %>
<%= f.text_area :body %>
<%= f.submit %>
<% end %>







