<p id="notice"><%= notice %></p>
  <h1 class="page-header">Change Requests</h1>
  <div class="panel panel-default">
              <div class="panel-heading"></div>
              <div class="panel-body">
                  <div class = "col-lg-4 form-group" >
                    <%= search_form_for @q do |f| %>
                      <div class="form-group">
                        <%= f.label :status %>
                        <%= f.select :aasm_state_cont, options_for_select([['Any','']] + ChangeRequest::STATUS), {}, {class: 'form-control'} %>
                      </div>
                  <%= f.submit class: 'btn btn-default' %>
                  <% end %>
                </div>
                <table class='table table-striped'>
                  <thead>
                    <tr>
                      <th>Change Summary</th>
                      <th>Request Date</th>
                      <th>Bussines Justification</th>
                      <th>Priority</th>
                      <th>Category</th>
                      <th>Type</th>
                      <th>Status</th>
                       <th>Approvers</th>
                       <th>Approve</th>
                       <th>Reject</th>
                      <th colspan="3">Action</th>
                    </tr>
                  </thead>

                  <tbody>
                    <% @change_requests.each do |change_request| %>
                      <tr>
                        <td><%=raw change_request.change_summary %></td>
                        <td><%=raw change_request.created_at.to_s(:long) %></td>
                         <td><%=raw change_request.business_justification %></td>
                        <td><%=raw change_request.priority%></td>
                        <td><%=raw change_request.category %></td>
                        <td><%=raw change_request.cr_type %></td>
                        <td><%= change_request.aasm_state %></td>
                        <td><%= change_request.approvers.count %></td>
                         <td><%= change_request.approvers_count %></td>
                        <td></td>
                        <td><%= link_to 'Show', change_request %></td>
                        <%if (current_user==change_request.user || current_user.is_admin || is_release_manager )&& !change_request.closed? %>
                        <td><%= link_to 'Edit', edit_change_request_path(change_request) %></td>
                        <td><%= link_to 'Destroy', change_request, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                         <% else %>
                        <td></td>
                        <td></td>
                        <% end %>
                    </tr>
                    <% end %>
                  </tbody>
                </table>
                  <%= paginate @change_requests, :theme => 'twitter-bootstrap-3' %>
<br>


<%= link_to 'New Change request', new_change_request_path %>
<br>
<%= link_to 'See Deleted Documents', deleted_change_requests_path %>

</div>
</div>
