<% require "html_truncator" %>
<section class="content-header">
  <h1>
    Change Requests
    <%= link_to  new_change_request_path, class: 'btn btn-flat btn-primary pull-right'  do %>
         <i class="fa fa-plus"></i> <strong>New Change Request</strong>
    <%end %> 
    </h1>
</section>
<section class="content">
 <div class="row">
    <div class='col-lg-6'>
      <%if flash[:destroy_cr_notice] != nil %>
      <div class='alert alert-danger'>
        <p id="notice"><%= flash[:destroy_cr_notice]  %></p>
      </div>
      <% end %>
    </div>
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header with-border">
          <h3 class="box-title">Change Request List</h3>
        
        </div><!-- /.box-header -->
        <div class="box-body table-responsive">
          <table class="table table-hover">
            <tr>
                <th>Request ID</th>
                <th>Change Summary</th>
                <th>Request Date</th>
                <th>Bussines Justification</th>
                <th>Priority</th>
                <th>Category</th>
                <th>Type</th>
                <th>Status</th>
                <th>Approvers</th>
                <th>Approve</th>
                <th>Reject</th>
                <th colspan="3">Action</th>
            </tr>
            <% @change_requests.each do |change_request| %> 
            <tr>
                <td><%= change_request.id %></td>
                <td><%=raw change_request.change_summary %></td>
                
                <td><%=raw change_request.created_at.to_s(:long) %></td>
                <td><%=raw HTML_Truncator.truncate(change_request.business_justification, 10) %>
                <td><%=raw change_request.priority%></td>
                <td><%=raw change_request.all_category %></td>
                <td><%=raw change_request.all_type %></td>
                <td><%= change_request.aasm_state %></td>
                <td><%= change_request.approvers.count %></td>
                <td><%= change_request.approvers_count %></td>
                <td><%= change_request.rejects_count %></td>
                <td><%= link_to 'Show', change_request %></td>
                <%if (current_user==change_request.user || current_user.is_admin || is_release_manager )&& !change_request.closed? %>
                <td><%= link_to 'Edit', edit_change_request_path(change_request) %></td>
                <% else %>
                <td></td>
                <% end %>
                <% if current_user==change_request.user || current_user.is_admin %>
                <td><%= link_to 'Destroy', change_request, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                <% else %>
                <td></td>
                <% end %>
            </tr>
            <% end %>
          </table>
        </div><!-- /.box-body -->
        <div class="box-footer clearfix">
            <%= paginate @change_requests, :theme => 'twitter-bootstrap-3'%>
        </div>
      </div><!-- /.box -->
    </div>

</div>
 <aside class="control-sidebar control-sidebar-light">                
        <!-- Tab panes -->
        <div class="tab-content">
          <!-- Home tab content -->
          <div class="tab-pane active" id="control-sidebar-home-tab">
            <h3 class="control-sidebar-heading">Filter</h3>
              <%= search_form_for @q do |f| %>
              <label>Change Request Category</label>
                <div class="form-group">
                  Network Equipment
                  <%= select :q, :category_network_equipment_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:category_network_equipment_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  Application
                  <%= select :q, :category_application_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:category_application_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  Server
                  <%= select :q, :category_server_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:category_server_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  User Access
                  <%= select :q, :category_user_access_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:category_user_access_true] : '' } %>
                </div>
                <div class="form-group">
                  Other Category
                  <%= f.search_field :category_other_cont, class: 'form-control'%>
                </div>
                <label>Change Request Type</label>
                <div class="form-group">
                  Security Update
                  <%= select :q, :type_security_update_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:type_security_update_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  Application
                  <%= select :q, :type_emergency_change_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:type_emergency_change_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  Server
                  <%= select :q, :type_configuration_change_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:type_configuration_change_true] : '' } %>
                  
                </div>
                <div class="form-group">
                  User Access
                  <%= select :q, :type_install_uninstall_true, [['Yes', 1], ['No', 0]], { include_blank: 'All', selected: params[:q] ? params[:q][:type_install_uninstall_true] : '' } %>
                </div>
                <div class="form-group">
                  Other Type
                  <%= f.search_field :type_other_cont, class: 'form-control'%>
                </div>

                <div class="form-group">
                    <%= f.label :status %>
                    <%= f.select :aasm_state_eq, options_for_select([['Any','']] + ChangeRequest::STATUS, params[:q]? params[:q][:aasm_state_eq] : 'Any' ), {}, {class: 'form-control select2'} %>
                </div>
                <div class="form-group">
                  <%= f.label :priority %>
                  <%= f.select :priority_eq, options_for_select([['Any','']] + ChangeRequest::PRIORITY, params[:q]? params[:q][:priority_eq] : 'Any' ), {}, {class: 'form-control select2'} %>
                </div>
                <div class="form-group">
                  <%= f.label :change_requirement %>
                  <%= f.search_field :change_requirement_cont, class: 'form-control'%>
                </div>
               
                <div class="form-group">
                  <%= f.label :business_justification %>
                  <%= f.search_field :business_justification_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :analysis %>
                  <%= f.search_field :analysis_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :impact %>
                  <%= f.search_field :impact_cont, class: 'form-control'%>
                </div>
                 <div class="form-group">
                  <%= f.label :scope %>
                  <%= f.select :scope_eq, options_for_select([['Any','']] + ChangeRequest::SCOPE, params[:q]? params[:q][:scope_eq] : 'Any' ), {}, {class: 'form-control select2'} %>
                </div>
                 <div class="form-group">
                  <%= f.label :design %>
                  <%= f.search_field :design_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :backup %>
                  <%= f.search_field :backup_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :net %>
                  <%= f.search_field :net_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :db %>
                  <%= f.search_field :db_cont, class: 'form-control'%>
                </div>
                <div class="form-group">
                  <%= f.label :os %>
                  <%= f.search_field :os_cont, class: 'form-control'%>
                </div>
                 <div class="form-group">
                  <%= f.label :created_at_between %><br>
                  from: <%= f.datetime_select :created_at_gteq, :include_blank => true, class: 'form-control' %><br>
                  until: <%= f.datetime_select :created_at_lteq,:include_blank => true, class: 'form-control' %>
                </div>
                 <div class="form-group">
                  <%= f.label :schedule_change_date_between %><br>
                  from: <%= f.datetime_select :schedule_change_date_gteq, :include_blank => true, class: 'form-control' %><br>
                  until: <%= f.datetime_select :schedule_change_date_lteq,:include_blank => true, class: 'form-control' %>
                </div>
                <div class="form-group">
                  <%= f.label :planned_completion_between %><br>
                  from: <%= f.datetime_select :planned_completion_gteq, :include_blank => true, class: 'form-control' %><br>
                  until: <%= f.datetime_select :planned_completion_lteq,:include_blank => true, class: 'form-control' %>
                </div>
                <div class="form-group">
                  <%= f.label :grace_period_starts_between %><br>
                  from: <%= f.datetime_select :grace_period_starts_gteq, :include_blank => true, class: 'form-control' %><br>
                  until: <%= f.datetime_select :grace_period_starts_lteq,:include_blank => true, class: 'form-control' %>
                </div>
                <div class="form-group">
                  <%= f.label :grace_period_date_end_between %><br>
                  from: <%= f.datetime_select :grace_period_end_gteq, :include_blank => true, class: 'form-control' %><br>
                  until: <%= f.datetime_select :grace_period_end_lteq,:include_blank => true, class: 'form-control' %>
                </div>
                <div class="form-group">
                  <%= f.label :grace_period_notes %>
                  <%= f.search_field :grace_period_notes_cont, class: 'form-control'%>
                </div>
                
                <%= f.submit class: 'btn btn-primary pull-right' %>
              <%end%>
              <%= search_form_for @q do |f| %>
              
               <%= f.submit 'Reset', class: 'btn btn-primary pull-left' %>
              <% end %>
              <br>
            
          </div><!-- /.tab-pane -->
          <!-- Stats tab content -->
        </div>
      </aside><!-- /.control-sidebar -->
      <!-- Add the sidebar's background. This div must be placed
           immediately after the control sidebar -->
      <div class='control-sidebar-bg'></div>


