<!--custom script to remove tinymce before init, it ressolve tinymce and turbolinks problem-->
<script>
  tinymce.remove();
  function eventHandler(inst) {
      unsaved = true;
  };
</script>
<%= form_for(@access_request) do |f| %>
  <% if @access_request.errors.any? %>
  <div id="error_explanation">
    <h3><%= pluralize(@access_request.errors.count, "error") %> prohibited this change_request from being saved:</h3>
    <ul>
      <% @access_request.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div><!--/error-explanation-->
  <% end %>
  <div class="row">
    <div class="col-md-12">
      
      <div class="box box-default">
        <div class="box-header with border"></div>
        <div class="box-body">
          <div class="col-md-6">
            
          </div><!--/col-->
          <div class="col-md-6">
            <div class="field form-group">
              <%= f.label :requestor_name %><br>
              <%= f.text_field :requestor_name, value: current_user.name, class: 'form-control', readonly: :readonly %>
            </div><!--/field-->

            <div class="field form-group">
              <label>Collaborators</label><br>
                <%= select_tag "collaborators_list" ,options_for_select(@users), class: 'select2-collaborate form-control', multiple:true %>
            </div><!--/field-->
            <div class="field form-group required">
              <label class="control-label">Approvers</label><br>
                <%= select_tag "approvers_list" ,options_for_select(@approvers), class: 'select2-approve form-control', multiple:true %>
            </div><!--/field-->


          </div><!--/col-->
        </div><!--/box-body-->
      </div> <!--/box-->

    </div><!--/col-->
  </div><!--/row-->
<% end %>

<script>
  $(document).ready(function () {
    $('body').attr("data-no-turbolink", "true");
    $('input[type="checkbox"].toggle').bootstrapToggle(); // assumes the checkboxes have the class "toggle"
    $('#save').click(function() {
      unsaved = false;
    });
    // Another way to bind the event
    $(window).bind('beforeunload', function() {
        if(unsaved){
            return "You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";
        }
    });
    // Monitor dynamic inputs
    $(document).on('change', ':input', function(){ //triggers change in all input fields including text type
        unsaved = true;
    });

    $('.datetimepicker').on("dp.change", function(e) {
      unsaved = true;
    });
  });
  $(function(){
    var collaborators = []
    <% @access_request.collaborators.each do |collaborator| %>
      collaborators.push('<%= collaborator.id %>');
    <% end %>
    $(".select2-collaborate").val(collaborators);
    $(".select2-collaborate").select2({
      tokenSeparators: [',', ' ']
    });
    var approvers = []
    <% @access_request.approvals.each do |approval| %>
      approvers.push('<%= approval.user_id %>'p);
    <% end %>
    $(".select2-approve").val(approvers);
    $(".select2-approve").select2({
      tokenSeparators: [',', ' ']
    });
  });

</script>
